(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{147:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(1),r=n(9),c=(n(0),n(160)),o={id:"remote-schemas",title:"Remote schemas",description:"Generate GraphQL schema objects that delegate to a remote server"},i={id:"remote-schemas",title:"Remote schemas",description:"Generate GraphQL schema objects that delegate to a remote server",source:"@site/docs/remote-schemas.md",permalink:"/docs/remote-schemas",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/remote-schemas.md",sidebar:"someSidebar",previous:{title:"Schema delegation",permalink:"/docs/schema-delegation"},next:{title:"Schema transforms",permalink:"/docs/schema-transforms"}},s=[{value:"Creating a Link",id:"creating-a-link",children:[{value:"Link API",id:"link-api",children:[]},{value:"Fetcher API",id:"fetcher-api",children:[]},{value:"Using cross-fetch",id:"using-cross-fetch",children:[]}]},{value:"API",id:"api",children:[{value:"makeRemoteExecutableSchema(options)",id:"makeremoteexecutableschemaoptions",children:[]},{value:"introspectSchema(fetcher, context)",id:"introspectschemafetcher-context",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"It can be valuable to be able to treat remote GraphQL endpoints as if they were local executable schemas. This is especially useful for ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/schema-stitching/"}),"schema stitching"),", but there may be other use cases."),Object(c.b)("p",null,"Generally, to create a remote schema, you need three steps:"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Create a ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"#creating-a-link"}),"link")," that can retrieve results from that schema"),Object(c.b)("li",{parentName:"ol"},"Use ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"#introspectschemafetcher-context"}),Object(c.b)("inlineCode",{parentName:"a"},"introspectSchema"))," to get the schema of the remote server"),Object(c.b)("li",{parentName:"ol"},"Use ",Object(c.b)("a",Object(a.a)({parentName:"li"},{href:"#makeremoteexecutableschemaoptions"}),Object(c.b)("inlineCode",{parentName:"a"},"makeRemoteExecutableSchema"))," to create a schema that uses the link to delegate requests to the underlying service")),Object(c.b)("p",null,"We've chosen to split this functionality up to give you the flexibility to choose when to do the introspection step. For example, you might already have the remote schema information, allowing you to skip the ",Object(c.b)("inlineCode",{parentName:"p"},"introspectSchema")," step entirely. Here's a complete example:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { HttpLink } from 'apollo-link-http';\nimport fetch from 'cross-fetch';\n\nconst link = new HttpLink({ uri: 'http://example.com/graphql', fetch });\n\nexport default async () => {\n  const schema = await introspectSchema(link);\n\n  const executableSchema = makeRemoteExecutableSchema({\n    schema,\n    link,\n  });\n\n  return executableSchema\n}\n\n")),Object(c.b)("p",null,"Now, let's look at all the parts separately."),Object(c.b)("h2",{id:"creating-a-link"},"Creating a Link"),Object(c.b)("p",null,"A link is a function capable of retrieving GraphQL results. It is the same way that Apollo Client handles fetching data and is used by several ",Object(c.b)("inlineCode",{parentName:"p"},"graphql-tools")," features to do introspection or fetch results during execution. Using an Apollo Link brings with it a large feature set for common use cases. For instance, adding error handling to your request is super easy using the ",Object(c.b)("inlineCode",{parentName:"p"},"apollo-link-error")," package. You can set headers, batch requests, and even configure your app to retry on failed attempts all by including new links into your request chain."),Object(c.b)("h3",{id:"link-api"},"Link API"),Object(c.b)("p",null,"Since graphql-tools supports using a link for the network layer, the API is the same as you would write on the client. To learn more about how Apollo Link works, check out the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.apollographql.com/docs/link/"}),"docs"),"; Both GraphQL and Apollo Links have slightly varying concepts of what ",Object(c.b)("inlineCode",{parentName:"p"},"context")," is used for. To make it easy to use your GraphQL context to create your Apollo Link context, ",Object(c.b)("inlineCode",{parentName:"p"},"makeRemoteExecutableSchema")," attaches the context from the graphql resolver onto the link context under ",Object(c.b)("inlineCode",{parentName:"p"},"graphqlContext"),"."),Object(c.b)("p",null,"Basic usage"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { HttpLink } from 'apollo-link-http';\nimport fetch from 'cross-fetch';\n\nconst link = new HttpLink({ uri: 'http://example.com/graphql', fetch });\n\nexport default async () => {\n  const schema = await introspectSchema(link);\n\n  const executableSchema = makeRemoteExecutableSchema({\n    schema,\n    link,\n  });\n\n  return executableSchema\n}\n")),Object(c.b)("p",null,"Authentication headers from context"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { setContext } from 'apollo-link-context';\nimport { HttpLink } from 'apollo-link-http';\nimport fetch from 'cross-fetch';\n\nconst http = new HttpLink({ uri: 'http://example.com/graphql', fetch });\n\nconst link = setContext((request, previousContext) => ({\n  headers: {\n    'Authorization': `Bearer ${previousContext.graphqlContext.authKey}`,\n  }\n})).concat(http);\n\n\nexport default async () => {\n  const schema = await introspectSchema(link);\n\n  const executableSchema = makeRemoteExecutableSchema({\n    schema,\n    link,\n  });\n\n  return executableSchema\n}\n")),Object(c.b)("h3",{id:"fetcher-api"},"Fetcher API"),Object(c.b)("p",null,"You can also use a fetcher (like cross-fetch) instead of a link. A fetcher is a function that takes one argument, an object that describes an operation:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"type Fetcher = (operation: Operation) => Promise<ExecutionResult>;\n\ntype Operation {\n  query: DocumentNode;\n  operationName?: string;\n  variables?: Object;\n  context?: Object;\n}\n")),Object(c.b)("h3",{id:"using-cross-fetch"},"Using cross-fetch"),Object(c.b)("p",null,"Basic usage"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import fetch from 'cross-fetch';\nimport { print } from 'graphql';\n\nconst fetcher = async ({ query: queryDocument, variables, operationName, context }) => {\n  const query = print(queryDocument);\n  const fetchResult = await fetch('http://example.com/graphql', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ query, variables, operationName })\n  });\n  return fetchResult.json();\n};\n\nexport default async () => {\n  const schema = makeRemoteExecutableSchema({\n    schema: await introspectSchema(fetcher),\n    fetcher,\n  });\n  return schema\n}\n")),Object(c.b)("p",null,"Authentication headers from context"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import fetch from 'cross-fetch';\nimport { print } from 'graphql';\n\nconst fetcher = async ({ query: queryDocument, variables, operationName, context }) => {\n  const query = print(queryDocument);\n  const fetchResult = await fetch('http://example.com/graphql', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${context.authKey}`,\n    },\n    body: JSON.stringify({ query, variables, operationName })\n  });\n  return fetchResult.json();\n};\n\nexport default async () => {\n  const schema = makeRemoteExecutableSchema({\n    schema: await introspectSchema(fetcher),\n    fetcher,\n  });\n\n  return schema\n}\n")),Object(c.b)("h2",{id:"api"},"API"),Object(c.b)("h3",{id:"makeremoteexecutableschemaoptions"},"makeRemoteExecutableSchema(options)"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"makeRemoteExecutableSchema")," takes a single argument: an object of options. The ",Object(c.b)("inlineCode",{parentName:"p"},"schema")," and either a ",Object(c.b)("inlineCode",{parentName:"p"},"fetcher")," or a ",Object(c.b)("inlineCode",{parentName:"p"},"link")," options are required."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { makeRemoteExecutableSchema } from 'graphql-tools';\n\nconst schema = makeRemoteExecutableSchema({\n  schema,\n  link,\n  // fetcher, you can pass a fetcher instead of a link\n});\n")),Object(c.b)("p",null,"Given a GraphQL.js schema (can be a non-executable client schema made by ",Object(c.b)("inlineCode",{parentName:"p"},"buildClientSchema"),") and a ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"#link-api"}),"Link")," or ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"#fetcher-api"}),"Fetcher"),", produce a GraphQL Schema that routes all requests to the link or fetcher."),Object(c.b)("p",null,"You can also pass a ",Object(c.b)("inlineCode",{parentName:"p"},"createResolver")," function to ",Object(c.b)("inlineCode",{parentName:"p"},"makeRemoteExecutableSchema")," to override how the fetch resolvers are created and executed. The ",Object(c.b)("inlineCode",{parentName:"p"},"createResolver")," param accepts a ",Object(c.b)("inlineCode",{parentName:"p"},"Fetcher")," as its first argument and returns a resolver function. This opens up the possibility for users to create batching mechanisms for fetches."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const createResolver: (fetcher: Fetcher) => GraphQLFieldResolver<any, any> = // . . .\n\nconst schema = makeRemoteExecutableSchema({\n  schema,\n  link,\n  createResolver\n});\n")),Object(c.b)("h3",{id:"introspectschemafetcher-context"},"introspectSchema(fetcher, ","[context]",")"),Object(c.b)("p",null,"Use ",Object(c.b)("inlineCode",{parentName:"p"},"link")," to build a client schema using introspection query. This function makes it easier to use ",Object(c.b)("inlineCode",{parentName:"p"},"makeRemoteExecutableSchema"),". As a result, you get a promise to a non-executable GraphQL.js schema object. Accepts optional second argument ",Object(c.b)("inlineCode",{parentName:"p"},"context"),", which is passed to the link; see the docs about links above for more details."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { introspectSchema } from 'graphql-tools';\n\nintrospectSchema(link).then((schema) => {\n  // use the schema\n});\n\n// or, with async/await:\nconst schema = await introspectSchema(link);\n")))}p.isMDXComponent=!0},160:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return b}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i({},t,{},e)),n},m=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=p(n),u=a,b=m["".concat(o,".").concat(u)]||m[u]||h[u]||c;return n?r.a.createElement(b,i({ref:t},l,{components:n})):r.a.createElement(b,i({ref:t},l))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,o=new Array(c);o[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var l=2;l<c;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);